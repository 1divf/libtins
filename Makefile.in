BASENAME=libtins.so
MAJOR=0
MINOR=2

SONAME=$(BASENAME).$(MAJOR)

CXX=@CXX@
CFLAGS=-c -Wall -fPIC @CFLAGS@ -DTINS_VERSION=@PACKAGE_VERSION@
LDFLAGS=-lpcap -shared -Wl,-soname,$(SONAME) -Wl,-z,defs
SOURCES=@SOURCE_FILES@

OBJECTS=$(SOURCES:.cpp=.o)
INCLUDE=-Iinclude/
EXECUTABLE=$(BASENAME).$(MAJOR).$(MINOR)
DEPS = $(SOURCES:.cpp=.d)

prefix = /usr
exec_prefix = $(prefix)

bindir = $(exec_prefix)/bin
libdir = $(exec_prefix)/lib
includedir = $(prefix)/include


all: $(SOURCES) $(EXECUTABLE)

compile: $(OBJECTS)

recompile: clean all

depends: $(SOURCES)
	rm -f ./depends.d
	make do_make_deps

do_make_deps: $(DEPS)

$(EXECUTABLE): $(OBJECTS)
	$(CXX) $(OBJECTS) $(LDFLAGS) -o $@

.cpp.o:
	$(CXX) $(CFLAGS) $(INCLUDE) $< -o $@

%.d : %.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDE) -MG -MM -MP -MT"$(<:.cpp=.o)" $< >> depends.d

clean:
	rm -f $(OBJECTS) $(EXECUTABLE)

install:
	install -d $(DESTDIR)$(includedir)/tins/
	install -m 644 include/* $(DESTDIR)$(includedir)/tins/
	install -d $(DESTDIR)$(libdir)
	install -m 644 $(EXECUTABLE) $(DESTDIR)$(libdir)/
	if [ -f $(DESTDIR)$(libdir)/$(BASENAME) ]; then rm $(DESTDIR)$(libdir)/$(BASENAME); fi
	if [ -f $(DESTDIR)$(libdir)/$(SONAME) ]; then rm $(DESTDIR)$(libdir)/$(SONAME); fi
	ln -s $(EXECUTABLE) $(DESTDIR)$(libdir)/$(BASENAME)
	ln -s $(EXECUTABLE) $(DESTDIR)$(libdir)/$(SONAME)

uninstall:
	rm -r $(DESTDIR)$(includedir)/tins/
	rm $(DESTDIR)$(libdir)/$(EXECUTABLE)
	rm $(DESTDIR)$(libdir)/$(BASENAME)
	rm $(DESTDIR)$(libdir)/$(SONAME)

include depends.d
